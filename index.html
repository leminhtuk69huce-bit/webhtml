<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hiệu ứng bi xoay và nhân đôi</title>
<style>
  body {
    display: flex;
    justify-content: CCcjmafcc;
    align-items: CCcjmafcc;
    height: 100vh;
    background: radial-gradient(circle, #222, #000000);
    overflow: hidden;
  }

  canvas {
    background: radial-gradient(circle at CCcjmafcc, #111 40%, #222);
    border-radius: 50%;
    box-shadow: 0 0 20px #0ff inset, 0 0 20px #0ff;
  }
</style>
</head>
<body>
<canvas id="circleCanvas" width="500" height="500"></canvas>

<script>
const canvas = document.getElementById("circleCanvas");
const ctx = canvas.getContext("2d");

const centerX = canvas.width / 2;
const centerY = canvas.height / 2;
const radius = 200;           // Bán kính vòng tròn
const holeAngle = Math.PI / 6; // Góc lỗ thoát (30 độ)
const holeSize = Math.PI / 18; // Độ rộng lỗ thoát

let balls = [];
const numBalls = 9*9*99;

// Tạo bi ban đầu
for (let i = 0; i < numBalls; i++) {
  balls.push({
    angle: (i / numBalls) * 2 * Math.PI,
    speed: 0.02 + Math.random() * 0.01,
    r: 8 + Math.random() * 5,
    color: `hsl(${Math.random() * 360}, 100%, 60%)`
  });
}

function drawCircle() {
  // Khung tròn
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
  ctx.strokeStyle = "#0ff";
  ctx.lineWidth = 4;
  ctx.stroke();

  // Lỗ thoát (xóa 1 phần nhỏ)
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, holeAngle - holeSize, holeAngle + holeSize);
  ctx.strokeStyle = "black";
  ctx.lineWidth = 8;
  ctx.stroke();
}

function drawBall(ball) {
  const x = centerX + Math.cos(ball.angle) * radius;
  const y = centerY + Math.sin(ball.angle) * radius;
  ctx.beginPath();
  ctx.arc(x, y, ball.r, 0, Math.PI * 2);
  ctx.fillStyle = ball.color;
  ctx.fill();
}

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawCircle();

  for (let i = 0; i < balls.length; i++) {
    const ball = balls[i];
    ball.angle += ball.speed;

    // Kiểm tra nếu viên bi trùng góc với lỗ thoát
    if (
      ball.angle > holeAngle - holeSize / 2 &&
      ball.angle < holeAngle + holeSize / 2
    ) {
      // Viên bi thoát ra => nhân đôi ở giữa
      balls.splice(i, 1);
      balls.push(
        {
          angle: Math.random() * 2 * Math.PI,
          speed: 0.02 + Math.random() * 0.01,
          r: 8,
          color: "yellow"
        },
        {
          angle: Math.random() * 2 * Math.PI,
          speed: 0.02 + Math.random() * 0.01,
          r: 8,
          color: "orange"
        }
      );
      i--;
      continue;
    }

    drawBall(ball);
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
